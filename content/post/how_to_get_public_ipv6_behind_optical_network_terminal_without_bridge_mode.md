+++
title = "不桥接光猫获取公网ipv6地址"
date = 2024-08-02T21:49:13+08:00
tags = ["网络", "NAS"]
categories = ['network']
keywords = ['不桥接','光猫', '公网ipv6']
markup = "mmark"
+++
今天综合网上搜到的信息，完成了不修改光猫为桥接但让局域网内所有设备都能获得公网ipv6地址
的成果，记录下来，也让有需要的人避免走弯路
<!--more-->
租得自如，自带免费的宽带，之前电信的网络，用超级管理员权限改桥接之后是全局域网有ipv6的，
前段时间换成了联通。结果发现当前联通的光猫已经可以后台改超密了，网上找的超密都不能用。打
电话给联通客服，他们明确表示不能开桥接。

局域网络内有一台NAS，会跑PT，也有从外部访问NAS内容的需要。当前的网络拓扑是

```text
NAS --- 红米路由C --- wifi桥接 --- 红米路由A --- 网络线连接 --- 光猫
```
为了让局域网内的设备都有公网ipv6地址，核心点如下
1. 光猫有ipv6地址，打开radvd开关，勾选【标志】0
2. 红米路由A，将光猫的网线接入到**lan**口，*ipv6配置成native模式之后*，切换到有线桥接上网模式
3. 红米路由C，同样将ipv6配置成native模式之后，切换到无线桥接上网模式，连接红米路由A的wifi

结束，至此局域网内所有设备都能有公网ipv6地址。

基本的原理是，通过步骤1，光猫是能够给它的lan广播ipv6配置信息，将分配给它的地址范围内的地址协商给局域网内的设备，
如果红米路由器A是通过wan口连接的光猫，由于光猫给到红米路由A的ipv6地址是一个固定地址了，已经不能再做地址分配，对
于连接在红米路由A上的设备，就都只能通过NAT6的方式访问外部ipv6资源，无法拥有各自的公网ipv6地址了。

通过提前将路由配置成native的ipv6模式后，路由的ipv6配置就是支持ipv6配置广播了，通过将光猫和红米路由A通过lan口
连接，实现了让所有连接在红米路由A上的设备都从属于光猫的lan网，这样光猫广播的ipv6配置信息就能让其下的其他设备收到，
从而获取到公网ipv6地址，这种方式也让光猫和红米路由A下的设备在ipv4也都在同一个网段下。
