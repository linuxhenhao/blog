<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>多功能启动U盘 - HuangYu的博客</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Huang Yu"><meta name=description content="制作一个同时具备一下四个功能的多功能启动U盘 1. 数据存储 2. windows系统安装 3. linux的livecd 4. mac安装
"><meta name=keywords content="多功能,安装U盘"><meta name=generator content="Hugo 0.84.4 with theme even"><link rel=canonical href=https://blog.huangyu.me/post/%E5%A4%9A%E5%8A%9F%E8%83%BD%E5%90%AF%E5%8A%A8u%E7%9B%98/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="多功能启动U盘"><meta property="og:description" content="制作一个同时具备一下四个功能的多功能启动U盘
1. 数据存储 2. windows系统安装
3. linux的livecd 4. mac安装"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.huangyu.me/post/%E5%A4%9A%E5%8A%9F%E8%83%BD%E5%90%AF%E5%8A%A8u%E7%9B%98/"><meta property="article:section" content="post"><meta property="article:published_time" content="2017-11-19T09:37:10+08:00"><meta property="article:modified_time" content="2017-11-19T09:37:10+08:00"><meta itemprop=name content="多功能启动U盘"><meta itemprop=description content="制作一个同时具备一下四个功能的多功能启动U盘
1. 数据存储 2. windows系统安装
3. linux的livecd 4. mac安装"><meta itemprop=datePublished content="2017-11-19T09:37:10+08:00"><meta itemprop=dateModified content="2017-11-19T09:37:10+08:00"><meta itemprop=wordCount content="4020"><meta itemprop=keywords content="多系统,启动U盘,"><meta name=twitter:card content="summary"><meta name=twitter:title content="多功能启动U盘"><meta name=twitter:description content="制作一个同时具备一下四个功能的多功能启动U盘
1. 数据存储 2. windows系统安装
3. linux的livecd 4. mac安装"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>HuangYu的博客</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>HuangYu的博客</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>多功能启动U盘</h1><div class=post-meta><span class=post-time>2017-11-19</span><div class=post-category><a href=/categories/operating_system/>operating_system</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"></div></div><div class=post-content><p>制作一个同时具备一下四个功能的多功能启动U盘
1. <strong>数据存储</strong> 2. <strong>windows系统安装</strong>
3. <strong>linux的livecd</strong> 4. <strong>mac安装</strong></p><h2 id=0-缘由>0. 缘由</h2><p>由于经常折腾系统，安装系统修复<code>grub</code>之类的事情，所以我的U盘常常被格式化。不然就是日常的
数据和系统文件混在一起十分不方便。终于决定对U盘进行分区，将常用的功能放到后面几个分区，
前面第一个分区用作数据分区（因为windows系统只识别U盘的第一个分区）。</p><h2 id=1-目标u盘结构>1. 目标U盘结构</h2><p>U盘总大小为29G，将其规划如下</p><table><thead><tr><th>编号</th><th>内容</th><th>大小</th></tr></thead><tbody><tr><td>1.</td><td>fat32 数据区</td><td>14G</td></tr><tr><td>2.</td><td>fat32 <code>grub</code>、<code>Clover</code>以及<code>winPE</code>和<code>gentoo admincd</code></td><td>8G</td></tr><tr><td>3.</td><td>hfsplus <code>macOS High Sierra</code>安装文件</td><td>7G</td></tr></tbody></table><h2 id=2-分区>2. 分区</h2><p>1. 格式化</p><p>使用linux的gparted工具按照上述规划进行分区，将3个分区都格式化成<code>fat32</code>，并且命名。其中
mac安装分区由于需要使用黑苹果安装，为了能够指定安装到该分区，该分区应该具备能够被macOS挂载
的格式和方便识别的名称，简单起见，都格式化成<code>fat32</code>。</p><p>2. 设置grub分区参数</p><p>gparted 设置<code>esp，boot</code>参数，使启动时计算机知道该分区为启动分区，找到efi文件夹的位置。<figure><img src=/images/post-images/gparted_multifunctional_usb.gif alt="gparted part creation"></figure></p><h2 id=3-安装grub>3. 安装grub</h2><p>我们的目标是该多功能U盘能够同时在只支持<code>bios</code>启动和<code>UEFI</code>启动的电脑上均能启动。由于<code>grub-efi</code>
和<code>grub-i386</code>两种模式的安装并不冲突。<code>EFI</code>模式只是将<code>.efi</code>文件放到<code>EFI</code>文件夹内，而<code>BIOS</code>模式
将一些信息写入<code>mbr</code>，二者共用<code>/boot/grub</code>文件夹，公用<code>/boot/grub/grub.cfg</code>配置文件。</p><p>首先假设我们将grub需要安装到的分区，也就是上图中的<code>/dev/sdc2</code>挂载到了<code>/mnt</code>，然后进行
grub的安装。</p><p>3.1 grub-efi 安装</p><p><code>efi-direcotry</code>参数必须指定，否则默认到进行grub-install所在的host的efi分区，导致无法
启动。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>grub-install --target=x86_64-efi --efi-directory /mnt --root-directory /mnt /dev/sdc</code></pre></td></tr></table></div></div><p><em>注意</em>: 对于计算机内部的硬盘，grub-install会将相应的启动路径信息写入到cmos当中，但是作为移动用的U盘，
这一行为显然是无法在不同计算机间迁移的。对于未在cmos中存在信息的分区，计算机会读取默认路径，也就是带有
esp标签的分区的<code>EFI/boot/boot.efi和EFI/boot/bootx64.efi</code>。为了让多功能启动U盘在其他电脑上的UEFI
模式下也能用，我们需要将安装好之后的分区内的<code>EFI/debian/grubx64.efi</code>复制到该分区的<code>EFI/boot/bootx64.efi</code>,
为了确保能启动，可以再复制一份保存为<code>boot.efi</code>在同一文件夹下。</p><p>3.2 grub-bios 安装</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>grub-install --target=i386-pc --root-directory /mnt /dev/sdc</code></pre></td></tr></table></div></div><p>3.3 grub调试</p><p>3.3.1 bios模式调试
使用qemu虚拟机进行grub配置的调试，默认为BIOS模式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>sudo qemu-system-x86_64 -m 1024 /dev/sdc</code></pre></td></tr></table></div></div><p>3.3.2 efi模式调试</p><p>通过添加<code>--bios</code>参数指定<code>tinycore</code>的efi模式启动：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>sudo qemu-system-x86_64 --bios /usr/share/ovmf/OVMF.fd -m 1024 /dev/sdc</code></pre></td></tr></table></div></div><p>如果系统中没有ovmf，debian系可以采用此命令安装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>apt-get install ovmf</code></pre></td></tr></table></div></div><p>但是，由于未知原因，<code>qemu</code>启动后并没有或者是无法读取到U盘的某些信息，导致其只能在第一个
分区中寻找<code>EFI</code>相关文件，而为了让数据分区干净，我们的<code>EFI</code>相关文件都在第二个分区，因此
无法使用此方式调试。</p><h2 id=4-linux-gentoo-admin-cd安装配置>4. linux (gentoo admin cd)安装配置</h2><p>作为不折腾不舒服斯基，常常会有弄坏引导，进不了grub等情况发生，这个时候一个体积小，功能
全的livecd就很有用。而gentoo的admincd才小于500M的体积就十分合适，而且实践发现，不需要额
外参数用于启动从iso文件复制到u盘中的内容。</p><p><a href=4>admincd下载</a></p><p>假设下载后的cd名称为<code>gentoo-admincd.iso</code>，<code>grub</code>所在分区<code>/dev/sdc2</code>挂载于<code>/mnt</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>sudo mount gentoo-admincd.iso /mnt1
sudo cp -R /mnt1/* /mnt  # 将iso内容全部复制到grub所在分区</code></pre></td></tr></table></div></div><p>根据cd内的<code>isolinux</code>配置，得到相应的<code>menuentry</code>需要的参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>menuentry &#34;gentoo admincd&#34; {
    insmod part_gpt
    insmod btrfs
    linux /isolinux/gentoo root=/dev/ram0 init=/linuxrc dokeymap \
              looptype=squashfs loop=/image.squashfs cdroot
    initrd /isolinux/gentoo.igz
}</code></pre></td></tr></table></div></div><h2 id=5-windows安装盘>5. windows安装盘</h2><p>5.1 windows7及以上的独立安装盘</p><p>有时候会有win7的装机需求，但是windows系的安装只用一个只有一个分区的U盘来的话比较容易，
一般不会出什么问题。需要注意的是，如果对该U盘进行过分区、调整大小等行为，可能会造成下面
的两种方式都不成功。最好是重建分区表后建立的单个的fat分区的U盘，肯定不会有莫名的问题。
5.1.1 对于mbr方式
将iso内容完全解压到fat分区，然后用grub-install给这个分区和盘安装i386-pc的grub，用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>ntldr /bootmgr</code></pre></td></tr></table></div></div><p>即可轻松安装。</p><p>5.1.2 对于uefi方式
这个方式更简单，直接将iso内容解压到fat分区，重启选择uefi从U盘启动即可，连grub都不需要。</p><h2 id=6-使用pe的通用型windows安装方式>6. 使用PE的通用型windows安装方式</h2><p>由于只有一个U盘，windows系统的安装对于多分区的U盘，上述方法则要求windows安装iso的内容
必须解压到第一个分区，grub也安装到第一个分区，才能够成功启动安装。但是这样导致普通文件
和系统文件混淆在一起，很不清晰。一个通用的安装方法是使用PE，而且是同时支持uefi和mbr方式
启动的PE。这就可以将PE的文件放在后面的分区当中，启动之后加载iso进行安装。</p><p>6.1 PE文件放置以及配置</p><p>PE型的iso文件与windows安装盘的iso不同，一般都可以直接解压到非第一个分区，使用grub加载
后能够正常启动。首先挂载PE的iso文件并复制：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>mount xxPE.iso /home/user/cdrom[随意找个挂载位置即可]
cp -R /home/user/cdrom/* /mnt  # mnt 为grub所在分区</code></pre></td></tr></table></div></div><p>然后配置相应的<code>menuentry</code>，对于BIOS模式的grub:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>menuentry &#34;winpe&#34; {
  ntldr /bootmgr
}</code></pre></td></tr></table></div></div><p>对于EFI模式的grub:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>menuentry &#34;winpe&#34;  {
  chainloader /efi/microsoft/boot/bootx64.efi
}</code></pre></td></tr></table></div></div><p>6.2 直接加载iso文件启动
某些PE不能用解压放置的方式启动，可以使用<code>memdisk</code>加载整个iso文件启动，但是性能以及通用性
不如文件解压的方法，在某些计算机上可能会失败。</p><p>使用<code>syslinux</code>项目中的<code>memdisk</code>加载iso，对于debian系的系统，才用此命令安装<code>memdisk</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>apt-get install grub-imageboot</code></pre></td></tr></table></div></div><p>装好后文件位于<code>/boot/memdisk</code>，将其复制到U盘grub所在分区根目录（此处为<code>/mnt/</code>）或者其
他目录，grub.cfg内容须做相应更改。</p><p>理论上来说，所有可以使用iso启动的iso文件都能通过<code>memdisk</code>直接加载iso文件启动，但是受制
于iso文件大小、内存大小等限制，太大的iso文件不太合适。</p><p><code>memdisk</code>使用方式：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>linux /memdisk iso *raw*
# 这个raw很关键，不加有些iso启动不了[memdiskwiki](1)
initrd /xxxPE.iso
# 需要启动的PE的iso文件，直接加载到内容，所以不宜过大</code></pre></td></tr></table></div></div><p>一个<code>menuentry</code>实例，iso文件大小为130M，放在grub所在分区中：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>menuentry &#34;winpe&#34; {
    insmod ntfs
    insmod part_gpt
    linux /memdisk iso raw
    initrd /TYx64Win8PE.iso
}</code></pre></td></tr></table></div></div><p>启动进入PE了之后，U盘只有第一个分区也就是数据分区可见，其他分区是看不到的，所以需要安装的windows
系统的iso文件要么放在第一个分区，或者放在硬盘上，然后就可以用PE中的安装工具安装了。</p><h2 id=7-clover加载用于启动macos安装>7. Clover加载用于启动macOS安装</h2><p>7.1 clover chainloader配置</p><p><a href=5>clover</a>是一个用于黑苹果安装的很好用的启动工具。具体的相关配置属于黑苹果安装配置的范畴，
这里就不多说。通过<code>grub2</code>的<code>chainloader</code>将<code>clover</code>启动，这样就能够启动<code>Installer</code>进行
系统安装或者是修复了。比如本次多功能U盘制作的原因－－将<code>macOS high Sierra</code>的根分区转换成
<code>APFS</code>。只能离线转换，因此不能进入<code>macOS</code>后转。</p><p>将<code>CLOVER</code>整个文件夹放到<code>grub</code>所在分区（这里的<code>/mnt</code>）的<code>/efi/</code>文件夹中。相应的<code>menuentry</code>为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>menuentry &#34;clover&#34; {
    insmod part_gpt
    insmod ntfs
    chainloader /efi/clover/cloverx64.efi
}</code></pre></td></tr></table></div></div><p>7.2 第三个<code>macOS Installer</code>分区的制作</p><p>这个制作在黑苹果当中进行，从<code>App store</code>中下载<code>macOS High Sierra 13.1.1</code>，然后打开文件
管理器<code>Finder</code>，点击使用<code>gparted</code>分区时分配给第三个分区的名字，挂载。假设名字为<code>MACUSB</code>，
那么挂载后位于<code>/Volumes/MACUSB</code>，下载后的安装<code>app</code>位于<code>/Applications/Install macOS High Sierra.app</code></p><p>使用一下命令将第三个分区制作成<code>macOS</code>安装盘</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>/Applications/Install macOS High Sierra.app/Contents/Resources/createinstallmedia \
--applicationpath /Applications/Install macOS High Sierra.app --volume /Volumes/MACUSB \
--nointeraction</code></pre></td></tr></table></div></div><p>完成后，从在<code>grub</code>界面选择<code>clover</code>，就会启动<code>clover</code>从而能够引导第三个分区中的<code>Installer</code></p><h2 id=8-grub-blind-mode修复以及biosefi模式的判定>8. grub blind mode修复以及BIOS|EFI模式的判定</h2><p>只在grub.cfg当中写menuentry项，启动时界面能够出来，但是一旦进入某一项boot之后，就会提示
<code>booting in blind mode</code>，然后黑屏。Arch的<a href=2>wiki</a>上有相应的解决办法。但是对于efi和
bios模式启动的grub，需要加载的模块不同，因此需要用到启动方式的判定。通过<a href=3><code>grub_platform</code></a>
进行判定。然后将系统中的字体文件复制到U盘上<code>grub</code>所在分区的<code>boot/grub</code>中</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cp /usr/share/grub/unicode.pf2 /mnt/boot/grub</code></pre></td></tr></table></div></div><p><code>grub_platform</code>的值，在<code>BIOS</code>模式下为<code>pc</code>，在<code>EFI</code>模式下为<code>efi</code>，均为小写，语法与<code>bash</code>相同．</p><p>相关的<code>grub.cfg</code>的内容如下，放在最上方即可，后面接上<code>menuentry</code>的内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>if [ x${grub_platform} == xpc ]; then
# pc means bios mode
      insmod vbe
else
# efi mode
    insmod efi_gop
    insmod efi_uga
fi
if loadfont ${prefix}/fonts/unicode.pf2
then
    insmod gfxterm
    set gfxmode=auto
    set gfxpayload=keep
    terminal_output gfxterm
fi</code></pre></td></tr></table></div></div><p>同时，由于<code>clover</code>只支持<code>EFI</code>模式，因此将<code>clover</code>的<code>menuentry</code>放在一个<code>if</code>判定内：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>    if [ x${grub_platform} == xefi ]; then
        menuentry &#34;clover&#34; {
            insmod part_gpt
            insmod ntfs
            chainloader /efi/clover/cloverx64.efi
        }
    fi</code></pre></td></tr></table></div></div><p>这样就只有是采用<code>EFI</code>模式引导的情况下才会出现<code>Clover</code>的项目．</p><p>完整的<code>grub.cfg</code>内容为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>if [ x${grub_platform} == xpc ]; then
# pc means bios mode
      insmod vbe
else
# efi mode
    insmod efi_gop
    insmod efi_uga
fi

if loadfont ${prefix}/fonts/unicode.pf2
then
    insmod gfxterm
    set gfxmode=auto
    set gfxpayload=keep
    terminal_output gfxterm
fi

menuentry &#34;gentoo admincd&#34; {
    insmod part_gpt
    insmod btrfs
    linux /isolinux/gentoo root=/dev/ram0 init=/linuxrc dokeymap \
              looptype=squashfs loop=/image.squashfs cdroot
    initrd /isolinux/gentoo.igz
}

if [ x${grub_platform} == xefi ]; then
  menuentry &#34;winpe&#34; {
    chainloader /efi/microsoft/boot/bootx64.efi
  }
else
  # for bios
  menuentry &#34;winpe&#34; {
    ntldr /bootmgr
  }
fi

if [ x${grub_platform} == xefi ]; then
    menuentry &#34;clover&#34; {
        insmod part_gpt
        insmod ntfs
        chainloader /efi/clover/cloverx64.efi
    }
fi</code></pre></td></tr></table></div></div><p>修改记录： 20180521： 添加关于efi模式正确运行需要的操作</p></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>Huang Yu</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2017-11-19</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/%E5%A4%9A%E7%B3%BB%E7%BB%9F/>多系统</a>
<a href=/tags/%E5%90%AF%E5%8A%A8u%E7%9B%98/>启动U盘</a></div><nav class=post-nav><a class=prev href=/post/debian%E7%B3%BB%E7%AE%80%E6%98%93%E5%86%85%E6%A0%B8%E6%89%93%E5%8C%85%E8%84%9A%E6%9C%AC/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Debian系简易内核打包脚本</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/iptables%E4%B8%ADowener%E4%BF%A1%E6%81%AF%E7%9A%84%E6%9D%A5%E6%BA%90/><span class="next-text nav-default">Iptables中owener信息的来源以及wireguard发包带有owner信息的原因探索</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=https://www.linkedin.com/in/yuhuang-keepmoving class="iconfont icon-linkedin" title=linkedin></a><a href=https://github.com/linuxhenhao class="iconfont icon-github" title=github></a><a href=https://blog.huangyu.me/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2017 -
2021<span class=heart><i class="iconfont icon-heart"></i></span><span>Huang Yu</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script><script type=text/javascript>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script></body></html>